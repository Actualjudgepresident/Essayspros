<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Orders | EssaysPros.com</title>
  <link rel="icon" type="image/png" href="favicon.png" />
  <link rel="stylesheet" href="style.css" />
  <meta name="description" content="View active, draft, and closed orders. Create a new order and track progress." />
  <style>
    :root{
      --blue-900:#0b1b46;
      --blue-800:#0f2a66;
      --blue-700:#1e3a8a;
      --blue-600:#2563eb;
      --blue-500:#4f6ef7;
      --blue-100:#eaf2ff;
      --ink:#0f172a;
      --muted:#475569;
      --line:#dbeafe;
      --card:#ffffff;
    }
    body{ background:var(--blue-100); color:var(--ink); font-family: system-ui, -apple-system, sans-serif; }
    .container { max-width: 1280px; margin: 0 auto; padding: 0 20px; }
    .siteHeader, .siteFooter { background: white; border-bottom: 1px solid var(--line); }
    .headerRow, .footerRow { display: flex; justify-content: space-between; align-items: center; padding: 16px 0; flex-wrap: wrap; gap: 16px; }
    .brand { font-size: 28px; font-weight: 900; color: var(--blue-900); text-decoration: none; }
    .nav a { margin-left: 24px; color: var(--muted); font-weight: 600; text-decoration: none; }
    .nav a.active, .nav a:hover { color: var(--blue-700); }
    .btnOutline, .btnPrimary { padding: 10px 20px; border-radius: 12px; font-weight: 900; cursor: pointer; }
    .btnOutline { border: 2px solid var(--blue-700); color: var(--blue-700); background: white; }
    .btnPrimary { background: linear-gradient(90deg, var(--blue-700), var(--blue-500)); color: white; border: none; }

    /* ────────────────────────────────────────────── */
    /*  The rest of your CSS ...                      */
    /* ────────────────────────────────────────────── */

    @media (max-width: 900px){
      .ordersTitle{ font-size:34px; }
      .searchBox{ min-width:220px; }
      .stepItem{ min-width:140px; }
    }
  </style>
</head>
<body>

  <header class="siteHeader">
    <div class="container headerRow">
      <a class="brand" href="index.html">EssaysPros</a>
      <nav class="nav">
        <a href="index.html">Home</a>
        <a class="active" href="orders.html">Orders</a>
        <a href="privacy.html">Privacy</a>
        <a href="terms.html">Terms</a>
        <a href="refund.html">Refund</a>
        <a href="contact.html">Contact</a>
      </nav>
      <div class="headerActions">
        <a class="btnOutline" id="loginBtn" href="login.html">Log in</a>
        <button class="btnPrimary" id="newOrderTopBtn" type="button">New order</button>
        <button class="btnOutline" id="logoutBtn" type="button" style="display:none;">Log out</button>
      </div>
    </div>
  </header>

  <main class="pageMain">
    <section class="container section ordersTop">
      <div class="ordersHeadRow">
        <div>
          <h1 class="ordersTitle">My orders</h1>
          <div class="ordersMeta" style="margin-top:10px;">
            <span class="statusPill" id="authPill">Signed out</span>
            <span class="statusPill" id="emailPill" style="display:none;">Email: —</span>
          </div>
        </div>
        <div class="ordersMeta">
          <a class="btnOutline" href="write.html">Write my order</a>
        </div>
      </div>

      <div class="tabsRow" role="tablist" aria-label="Orders">
        <button class="tabBtn active" type="button" dataTab="active">Active</button>
        <button class="tabBtn" type="button" dataTab="drafts">Drafts</button>
        <button class="tabBtn" type="button" dataTab="closed">Closed</button>
      </div>

      <div class="controlsRow">
        <div class="sortRow">
          <span>Sort by</span>
          <select id="sortSelect">
            <option value="deadlineLatest">Deadline, latest</option>
            <option value="deadlineSoonest">Deadline, soonest</option>
            <option value="createdLatest">Created, latest</option>
            <option value="createdOldest">Created, oldest</option>
          </select>
        </div>
        <div class="searchBox">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z" stroke="#475569" stroke-width="2"/>
            <path d="M16.5 16.5 21 21" stroke="#475569" stroke-width="2" stroke-linecap="round"/>
          </svg>
          <input id="searchInput" type="text" placeholder="Search orders" />
        </div>
      </div>

      <div class="panel" id="ordersPanel">
        <div class="empty" id="emptyState">
          <div class="emptyInner">
            <h2 class="emptyTitle" id="emptyTitle">You have no active orders</h2>
            <p class="emptySub" id="emptySub">
              Create a new order to begin, or sign in to view drafts and closed orders.
            </p>
            <div class="emptyActions">
              <button class="btnPrimary" type="button" id="newOrderBtn">New order</button>
              <a class="btnOutline" href="login.html" id="signinLink">Sign in</a>
            </div>
          </div>
        </div>
        <div id="listState" style="display:none;">
          <div class="cardList" id="ordersList"></div>
        </div>
      </div>
    </section>
  </main>

  <!-- ────────────────────────────────────────────── -->
  <!--               New Order Modal                  -->
  <!-- ────────────────────────────────────────────── -->

  <div class="overlay" id="orderOverlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-label="New order">
      <div class="modalTop">
        <h2 class="modalTitle">New order</h2>
        <button class="closeBtn" id="closeOrder" type="button" aria-label="Close">×</button>
      </div>
      <div class="modalBody">
        <div class="stepsBar" id="stepsBar">
          <div class="stepItem on" dataStep="1"><span class="stepDot"></span><span>Service</span></div>
          <div class="stepItem" dataStep="2"><span class="stepDot"></span><span>Details</span></div>
          <div class="stepItem" dataStep="3"><span class="stepDot"></span><span>Academic</span></div>
          <div class="stepItem" dataStep="4"><span class="stepDot"></span><span>Size</span></div>
          <div class="stepItem" dataStep="5"><span class="stepDot"></span><span>Deadline</span></div>
          <div class="stepItem" dataStep="6"><span class="stepDot"></span><span>Instructions</span></div>
          <div class="stepItem" dataStep="7"><span class="stepDot"></span><span>Payment</span></div>
        </div>

        <!-- Stage 1 -->
        <div class="stage" dataStage="1">
          <h3 class="stageTitle">Service</h3>
          <div class="chipRow" id="serviceRow">
            <button class="chipBtn" type="button" dataValue="writing">Writing</button>
            <button class="chipBtn" type="button" dataValue="rewriting">Rewriting</button>
            <button class="chipBtn" type="button" dataValue="editing">Editing</button>
            <button class="chipBtn" type="button" dataValue="proofreading">Proofreading</button>
            <button class="chipBtn" type="button" dataValue="problemSolving">Problem solving</button>
            <button class="chipBtn" type="button" dataValue="calculations">Calculations</button>
            <button class="chipBtn" type="button" dataValue="reviewWork">Review my work</button>
          </div>
          <div class="footerBar">
            <button class="backBtn" type="button" id="cancelOrder1">Cancel</button>
            <button class="nextBtn" type="button" id="next1" disabled>Next</button>
          </div>
        </div>

        <!-- The other stages remain the same as you provided -->

        <!-- Stage 7 – Payment -->
        <div class="stage" dataStage="7" style="display:none;">
          <h3 class="stageTitle">Payment</h3>
          <div class="payCard">
            <div class="payRow"><span>Service</span><span id="sumService" class="mutedSmall">—</span></div>
            <div class="payRow"><span>Assignment</span><span id="sumAssignment" class="mutedSmall">—</span></div>
            <div class="payRow"><span>Academic level</span><span id="sumLevel" class="mutedSmall">—</span></div>
            <div class="payRow"><span>Size</span><span id="sumSize" class="mutedSmall">—</span></div>
            <div class="payRow"><span>Deadline</span><span id="sumDeadline" class="mutedSmall">—</span></div>
            <div class="payRow" style="margin-top:6px; font-size:18px; color:var(--blue-900);">
              <span>Total</span><span id="sumTotal">$0.00</span>
            </div>
            <button class="stripeBtn" type="button" id="payStripeBtn">Pay with Stripe</button>
            <div class="mutedSmall">
              Stripe Checkout requires a server endpoint that creates a Checkout Session.<br>
              This button calls an endpoint named <code>/create-checkout-session</code>.
            </div>
          </div>
          <div class="footerBar">
            <button class="backBtn" type="button" id="back7">Back</button>
            <button class="nextBtn" type="button" id="finishBtn">Finish</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <footer class="siteFooter">
    <div class="container footerRow">
      <div>
        <div class="brandSmall">EssaysPros</div>
        <div class="muted">© <span id="year"></span> EssaysPros.com. All rights reserved.</div>
        <div class="muted" style="margin-top:6px;">
          <a href="mailto:support@essayspros.com">support@essayspros.com</a> |
          <a href="mailto:orders@essayspros.com">orders@essayspros.com</a> |
          <a href="mailto:billing@essayspros.com">billing@essayspros.com</a>
        </div>
      </div>
      <div class="footerLinks">
        <a href="privacy.html">Privacy</a>
        <a href="terms.html">Terms</a>
        <a href="refund.html">Refund</a>
        <a href="contact.html">Contact</a>
      </div>
    </div>
  </footer>

  <script>
    document.getElementById("year").textContent = new Date().getFullYear();

    // ─── DOM Elements ───────────────────────────────────────
    const loginBtn        = document.getElementById("loginBtn");
    const logoutBtn       = document.getElementById("logoutBtn");
    const newOrderBtn     = document.getElementById("newOrderBtn");
    const newOrderTopBtn  = document.getElementById("newOrderTopBtn");
    const authPill        = document.getElementById("authPill");
    const emailPill       = document.getElementById("emailPill");
    const orderOverlay    = document.getElementById("orderOverlay");
    const closeOrder      = document.getElementById("closeOrder");
    const cancelOrder1    = document.getElementById("cancelOrder1");

    const stageEls = Array.from(document.querySelectorAll("[dataStage]"));
    const stepEls  = Array.from(document.querySelectorAll("[dataStep]"));

    const serviceRow     = document.getElementById("serviceRow");
    const next1          = document.getElementById("next1");

    const assignmentType = document.getElementById("assignmentType");
    const subject        = document.getElementById("subject");
    const next2          = document.getElementById("next2");
    const back2          = document.getElementById("back2");

    const levelRow       = document.getElementById("levelRow");
    const next3          = document.getElementById("next3");
    const back3          = document.getElementById("back3");

    const unitPages      = document.getElementById("unitPages");
    const unitWords      = document.getElementById("unitWords");
    const minusBtn       = document.getElementById("minusBtn");
    const plusBtn        = document.getElementById("plusBtn");
    const sizeVal        = document.getElementById("sizeVal");
    const sizeHint       = document.getElementById("sizeHint");
    const spacing        = document.getElementById("spacing");
    const next4          = document.getElementById("next4");
    const back4          = document.getElementById("back4");

    const dueDate        = document.getElementById("dueDate");
    const dueTime        = document.getElementById("dueTime");
    const deadlineQuickRow = document.getElementById("deadlineQuickRow");
    const next5          = document.getElementById("next5");
    const back5          = document.getElementById("back5");

    const orderName      = document.getElementById("orderName");
    const instructions   = document.getElementById("instructions");
    const uploadBox      = document.getElementById("uploadBox");
    const fileInput      = document.getElementById("fileInput");
    const fileLabel      = document.getElementById("fileLabel");
    const next6          = document.getElementById("next6");
    const back6          = document.getElementById("back6");

    const sumService     = document.getElementById("sumService");
    const sumAssignment  = document.getElementById("sumAssignment");
    const sumLevel       = document.getElementById("sumLevel");
    const sumSize        = document.getElementById("sumSize");
    const sumDeadline    = document.getElementById("sumDeadline");
    const sumTotal       = document.getElementById("sumTotal");
    const payStripeBtn   = document.getElementById("payStripeBtn");
    const back7          = document.getElementById("back7");
    const finishBtn      = document.getElementById("finishBtn");

    const tabBtns        = Array.from(document.querySelectorAll(".tabBtn"));
    const emptyTitle     = document.getElementById("emptyTitle");
    const emptySub       = document.getElementById("emptySub");
    const signinLink     = document.getElementById("signinLink");
    const ordersPanel    = document.getElementById("ordersPanel");
    const emptyState     = document.getElementById("emptyState");
    const listState      = document.getElementById("listState");
    const ordersList     = document.getElementById("ordersList");
    const searchInput    = document.getElementById("searchInput");
    const sortSelect     = document.getElementById("sortSelect");

    // ─── State ──────────────────────────────────────────────
    const state = {
      stage: 1,
      service: "",
      assignmentType: "",
      subject: "",
      level: "",
      sizeUnit: "pages",
      sizeCount: 1,
      spacing: "double",
      deadlineDate: "",
      deadlineTime: "",
      orderName: "",
      instructions: "",
      filesCount: 0,
      total: 0
    };

    // ─── Helpers ────────────────────────────────────────────
    function signedEmail() {
      return (localStorage.getItem("essayspros_active_email") || "").trim();
    }

    function isSignedIn() {
      return !!signedEmail();
    }

    function gotoLogin() {
      localStorage.setItem("returnAfterAuth", "orders.html");
      window.location.href = "login.html";
    }

    function renderAuth() {
      if (isSignedIn()) {
        const email = signedEmail();
        authPill.textContent = "Signed in";
        emailPill.style.display = "inline-flex";
        emailPill.textContent = "Email: " + email;
        loginBtn.style.display = "none";
        logoutBtn.style.display = "inline-flex";
        signinLink.style.display = "none";
      } else {
        authPill.textContent = "Signed out";
        emailPill.style.display = "none";
        loginBtn.style.display = "inline-flex";
        logoutBtn.style.display = "none";
        signinLink.style.display = "inline-flex";
      }
      applyTabAccess();
      renderOrders();
    }

    function applyTabAccess() {
      const signed = isSignedIn();
      tabBtns.forEach(btn => {
        const tab = btn.getAttribute("dataTab");
        const locked = (!signed && tab !== "active");
        btn.style.opacity = locked ? "0.55" : "1";
        btn.style.cursor  = locked ? "not-allowed" : "pointer";
      });
    }

    function setActiveTab(tab) {
      tabBtns.forEach(btn => {
        btn.classList.toggle("active", btn.getAttribute("dataTab") === tab);
      });

      if (tab === "active") {
        emptyTitle.textContent = "You have no active orders";
        emptySub.textContent   = "Create a new order to begin, or sign in to view drafts and closed orders.";
      }
      if (tab === "drafts") {
        emptyTitle.textContent = "You have no draft orders";
        emptySub.textContent   = "Drafts are saved when checkout begins. Sign in to view them.";
      }
      if (tab === "closed") {
        emptyTitle.textContent = "You have no closed orders";
        emptySub.textContent   = "Closed orders appear here once completed. Sign in to view history.";
      }

      renderOrders();
    }

    function requireAuthOrRedirect() {
      if (!isSignedIn()) {
        gotoLogin();
        return false;
      }
      return true;
    }

    function openOrder() {
      orderOverlay.style.display = "flex";
      orderOverlay.setAttribute("aria-hidden", "false");
      showStage(1);
    }

    function closeOrderModal() {
      orderOverlay.style.display = "none";
      orderOverlay.setAttribute("aria-hidden", "true");
      // Optional: reset state if you want fresh start every time
      // Object.assign(state, { stage:1, service:"", ... });
    }

    function showStage(n) {
      state.stage = n;
      stageEls.forEach(el => {
        const st = Number(el.getAttribute("dataStage"));
        el.style.display = (st === n) ? "block" : "none";
      });

      stepEls.forEach(el => {
        const st = Number(el.getAttribute("dataStep"));
        el.classList.remove("on", "done");
        if (st < n) el.classList.add("done");
        if (st === n) el.classList.add("on");
      });

      validateStage();
      if (n === 7) renderSummary();
    }

    function validateStage() {
      const n = state.stage;
      let can = false;

      if (n === 1) can = !!state.service;
      if (n === 2) can = !!state.assignmentType && !!state.subject.trim();
      if (n === 3) can = !!state.level;
      if (n === 4) can = state.sizeCount >= 1;
      if (n === 5) can = !!state.deadlineDate;   // at minimum date
      if (n === 6) can = !!state.orderName.trim() || !!state.instructions.trim(); // loose
      if (n === 7) can = true;

      const nextBtn = document.getElementById(`next${n}`);
      if (nextBtn) nextBtn.disabled = !can;
    }

    function renderSummary() {
      sumService.textContent    = state.service ? state.service.charAt(0).toUpperCase() + state.service.slice(1) : "—";
      sumAssignment.textContent = assignmentType.options[assignmentType.selectedIndex]?.text || "—";
      sumLevel.textContent      = levelLabel(state.level);
      sumSize.textContent       = `${state.sizeCount} ${state.sizeUnit} (${state.spacing} spacing)`;
      sumDeadline.textContent   = state.deadlineDate ? `${state.deadlineDate} ${state.deadlineTime || ""}` : "—";
      sumTotal.textContent      = "$0.00"; // placeholder — real calc should be here
    }

    function levelLabel(v) {
      const map = {
        highSchool: "High school",
        college:    "College",
        bachelors:  "Bachelor’s",
        masters:    "Master’s",
        doctorate:  "Doctorate"
      };
      return map[v] || "—";
    }

    // ─── Event Listeners ────────────────────────────────────
    loginBtn.addEventListener("click", () => gotoLogin());
    logoutBtn.addEventListener("click", () => {
      localStorage.removeItem("essayspros_active_email");
      renderAuth();
    });

    newOrderBtn.addEventListener("click", openOrder);
    newOrderTopBtn.addEventListener("click", () => {
      if (requireAuthOrRedirect()) openOrder();
    });

    closeOrder.addEventListener("click", closeOrderModal);
    cancelOrder1.addEventListener("click", closeOrderModal);

    // Service chips
    chipSelect(serviceRow, "service", next1);

    next1.addEventListener("click", () => showStage(2));
    back2.addEventListener("click", () => showStage(1));
    back3.addEventListener("click", () => showStage(2));
    back4.addEventListener("click", () => showStage(3));
    back5.addEventListener("click", () => showStage(4));
    back6.addEventListener("click", () => showStage(5));
    back7.addEventListener("click", () => showStage(6));

    // Very basic validation triggers
    assignmentType.addEventListener("change", validateStage);
    subject.addEventListener("input", validateStage);
    levelRow.querySelectorAll("button").forEach(b => b.addEventListener("click", validateStage));

    // Quick deadline buttons
    deadlineQuickRow.querySelectorAll("button").forEach(btn => {
      btn.addEventListener("click", () => {
        const hours = Number(btn.dataset.hours);
        if (!hours) return;

        const now = new Date();
        now.setHours(now.getHours() + hours);

        state.deadlineDate = now.toISOString().split("T")[0];
        state.deadlineTime = now.toTimeString().slice(0,5);

        dueDate.value = state.deadlineDate;
        dueTime.value = state.deadlineTime;

        validateStage();
      });
    });

    // Placeholder render functions (to be expanded)
    function renderOrders() {
      // TODO: actually load from localStorage / backend
      ordersList.innerHTML = "";
      listState.style.display = "none";
      emptyState.style.display = "flex";
    }

    function chipSelect(container, key, nextBtn) {
      const buttons = container.querySelectorAll("button");
      buttons.forEach(b => {
        b.addEventListener("click", () => {
          buttons.forEach(x => x.classList.remove("active"));
          b.classList.add("active");
          state[key] = b.dataset.value;
          validateStage();
          if (nextBtn) nextBtn.disabled = !state[key];
        });
      });
    }

    // Init
    renderAuth();
    setActiveTab("active");

    // For demo – open modal directly (remove in production)
    // openOrder();
  </script>
</body>
</html>
